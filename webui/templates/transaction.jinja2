{% extends "base.jinja2" %}

{% block title %}Transaction {{ tx_id_trunc }} - Haruka's Aleo Explorer{% endblock %}

{% block head %}

    <style>

        #data {
            margin: 20px 4px;
        }

        #transitions, #program {
            margin-top: 20px;
        }

        .text-alert {
            color: #cc4b37;
        }

    </style>

{% endblock %}

{% from "macros.jinja2" import data_line %}

{% block content %}

    <div class="content">
        <div class="header">
            <h3>Transaction {{ tx_id_trunc }}</h3>
        </div>

        <div id="data">
        {% call data_line("Transaction ID") %}
            <span class="mono">{{ tx_id }}</span>
        {% endcall %}
        {% call data_line("Block") %}
            <a href="/block?h={{ block.header.metadata.height }}">{{ block.header.metadata.height }}</a>
        {% endcall %}
        {% call data_line("Type") %}
            {{ type }}
        {% endcall %}
        {% if type == "Execute" %}
            {% call data_line("Global state root") %}
            <span class="mono">{{ global_state_root }}</span>
            {% endcall %}
            {% call data_line("Inclusion proof") %}
                {% if inclusion_proof %}
                    <advanced-link scope="transaction" object="{{ tx_id }}" type="inclusion_proof">
                        <span class="mono">{{ inclusion_proof }}</span>
                    </advanced-link>
                {% else %}
                    -
                {% endif %}
            {% endcall %}
        {% elif type == "Deploy" %}
            {% call data_line("Edition") %}
                {{ edition }}
            {% endcall %}
        {% endif %}
        {% call data_line("Total fee") %}
            {{ total_fee | format_aleo_credit }} Aleo credits
        {% endcall %}
        </div>

    {% if type == "Deploy" %}
        <div id="program">
            <h4>Deployed program</h4>
            {% call data_line("Program ID") %}
                <span class="mono">{{ program_id }}</span>
            {% endcall %}
            {% call data_line("Imports") %}
                <span class="mono">
                {% if imports %}
                    {% for import in imports %}
                        {{ import }}<br>
                    {% endfor %}
                {% else %}
                    -
                {% endif %}
                </span>
            {% endcall %}
            {% call data_line("Mappings") %}
                <span class="mono">
                {% if mappings %}
                    {% for mapping in mappings %}
                        {{ mapping }}<br>
                    {% endfor %}
                {% else %}
                    -
                {% endif %}
                </span>
            {% endcall %}
            {% call data_line("Structs") %}
                <span class="mono">
                {% if interfaces %}
                    {% for struct in interfaces %}
                        {{ struct }}<br>
                    {% endfor %}
                {% else %}
                    -
                {% endif %}
                </span>
            {% endcall %}
            {% call data_line("Records") %}
                <span class="mono">
                {% if records %}
                    {% for record in records %}
                        {{ record }}<br>
                    {% endfor %}
                {% else %}
                    -
                {% endif %}
                </span>
            {% endcall %}
            {% call data_line("Functions") %}
                <span class="mono">
                {% if closures %}
                    {% for function in closures %}
                        {{ function }}<br>
                    {% endfor %}
                {% else %}
                    -
                {% endif %}
                </span>
            {% endcall %}
            {% call data_line("Transitions") %}
                <span class="mono">
                {% for transition in functions %}
                    {{ transition }}<br>
                {% endfor %}
                </span>
            {% endcall %}

        </div>
    {% endif %}

        <div id="transitions">
            <h4>{% if type == "Deploy" %}Fee transition{% else %}Transitions{% endif %}</h4>
            <table id="transitions-table">
                <thead>
                <tr>
                    <td>Transition ID</td>
                    <td>Program / Function call</td>
                    <td>Fee</td>
                </tr>
                </thead>
                <tbody>
                {% for transition in transitions %}
                    <tr>
                        <td>
                            <span class="mono"><a href="/transition?id={{ transition.transition_id }}">{{ transition.transition_id }}</a></span>
                        </td>
                        <td><span class="mono">{{ transition.action }}</span></td>
                        <td>{{ transition.fee | format_aleo_credit }}</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

{% endblock %}